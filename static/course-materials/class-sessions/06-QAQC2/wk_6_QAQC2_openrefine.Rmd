---
title: "LAS 6292: Data Organization in Spreadsheets"
date: "updated: `r Sys.Date()`"
header-includes:
- \AtBeginDocument{\let\maketitle\relax} # this removes default title section
- \usepackage[default]{sourcesanspro}
- \usepackage{fancyhdr} # modify header into left, center, right
- \pagestyle{fancy} # cues the use of fancy headers
- \fancyfoot{} # cues the use of fancy footer
# month & year on header left
- \fancyhead[L]{LAS 6292 Spring `r format(Sys.time(), '%Y')`, EM Bruna} 
# name and page on header right
- \fancyhead[R]{QA/QC 2 - OpenRefine, p. \thepage} 
- \fancyfoot[R]{Last update `r format(Sys.time(), '%d %B %Y')`}
# - \usepackage{setspace}{singlespace} # manipulate line spacing 
- \usepackage{parskip} # manipulate indents and spacing before/after paragra phs 
- \usepackage{xcolor} # changes colors of text
# to center to top level (#) headings (my name) and change color of font
# more info # https://www.ctan.org/pkg/sectsty
- \usepackage{sectsty} \sectionfont{\centering\color{darkmidnightblue}}
# to center to sub-sub-headings (###) and change color of font
- \usepackage{sectsty} \subsectionfont{\color{darkmidnightblue}}
# http://latexcolor.com/ to choose colors
# define the colors used above with rgb codes
- \definecolor{darkcerulean}{rgb}{0.03, 0.27, 0.49}
- \definecolor{darkmidnightblue}{rgb}{0.0, 0.2, 0.4}
# - \usepackage{ragged2e}
# - \setlength\RaggedRightParindent{15pt}
# - \RaggedRight - # make the right margin ragged
# https://tex.stackexchange.com/questions/258714/prevent-hyphenation-across-lines-enforce-right-margin
# - \hyphenpenalty=10000 #to suppress ordinary hyphenation
# - \exhyphenpenalty=10000 #to prohibit line breaks at explicit hyphens.
# - \setstretch{1.0}

# https://babichmorrowc.github.io/post/changing-fonts-in-rmarkdown-pdfs/

mainfont: SourceSansPro
geometry: margin=1in
fontsize: 12pt
linkcolor: blue
urlcolor: blue
output:
  pdf_document: default
  # html_document:
  #   df_print: paged
  # rmdformats::robobook: default
---


```{r setup, include=FALSE}
library(knitr)
library(rmdformats)

## Global options
options(max.print="75")
opts_chunk$set(echo=FALSE,
	             cache=TRUE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE)
opts_knit$set(width=75)
```

# Class Outline: QA/QC 2 - Open Refine

## Objectives and Competencies:   

By the end of this lesson students will:

* Be able to import a data set into OpenRefine, make changes to the data set and its structure, and export the revised data set  

* Learn how to automatically track changes made and export the record of changes

* Be able to apply these changes to a different data set

## Pre-Class Preparation (Instructor):  

  * Remind via email about OpenRefine Installation
  * Post Data sets

**Bring to Class:  **  

  * Snacks
  * Flip charts and markers
  * Dry write markers
  * Tent cards for student names


## Pre-class Preparation (Students):

### **Online Lectures:**  None

### **Readings**: None

### Computer Resources

1. Install OpenRefine on your computer and verify it works by following the [instructions here](https://datacarpentry.org/openrefine-socialsci/setup.html).

2. Scan the [basic workflow](https://hackmd.io/WnKT7eiMQde7jCF5teVHBQ#Setup) for what we will be doing.

3. Read about OpenRefine and see some quick videos of [how it works here](https://openrefine.org/)


```{r timer, echo=FALSE}
part_1 <- 10
part_2 <- 10
part_3 <- 45
snack_break <- 10
part_4 <-30
part_5 <-45
part_6 <-10

total_time <- 
  part_1 + 
  part_2 + 
  part_3 + 
  part_4 +
  part_5 +
  part_6 +
  snack_break 

time_remain <- 180 - total_time
```


## In-Class: Using Open Refine to clean data

OpenRefine is a powerful, free, and open source tool that is used to work with and clean messy data.  We will be working through some of OpenRefine's basic features, after which you will trying them onm your own on a new data set.

**_Notes: _**

1. This is the url for accessing OpenRefine if a new tab/window doesn't open: http://127.0.0.1:3333/

2. To download the data file for the tutorial to your computer [click this link](https://ndownloader.figshare.com/files/11502815). (url: https://ndownloader.figshare.com/files/11502815)



### **intro to OR** (`r part_1` min)

### **Working with OR**  (`r part_2` min)  

### **Filtering and Sorting** (`r part_3` min)
     
### Break (`r snack_break` min)

### **Examining Numbers** (`r part_4` min)

### **Using Scripts, Exporting, and Saving**  (`r part_5` min)  

### **Wrap-up, Questions**  (`r part_6` min)  

## **Assignment** (`r time_remain` min)

Now it's your turn. Use Open Refine to clean up this data set. After you create a Project, edit the data as follows:

1. Correct and standardize the names of the countries in which the rodents were captured. 

2. The column `scientificName` contains two pieces of information (the Genus _and_ species of each animal). Split this into two columns, rename them as `genus` and `species`, and then correct and standardize the data in each column as needed. NB: You may run into an obstacle when you try to rename the columns. How can you get around it?

3. Save the clean data as a CSV file on your desktop.

<!-- grel:	if(value=="AH","Ammospermophilus harrisi","") -->

4. Extract and save your steps (i.e., 'operation history' as JSON. Save this as a text file. 

5. _Bonus Brainteaser:_ Many of the cells in the column for the Latin bonomial are blank. How might you go about filling them in based on the column with the abbreviation?

6. **Submission:** Submit your clean .csv and the JSON text file as `week6_hw` on Canvas.  

### Grading Rubric: 

Data corrected and JSON file can be used on another data set: 50  
Most data correction properly programmed; some require instructor follow-up: 40  
Many of the corrections missing, JSON file unable to process new data : 30  
Instructor follow-up required to implement most changes: 20  

# Sources for this lesson 

1. Data Carpentry: [Data Cleaning with OpenRefine for Social Scientists	](https://datacarpentry.org/openrefine-socialsci/). 

<!-- Peter Smyth, Geoff LaFlair, Lachlan Deer, Tracy Teal, Karen Word, FranÃ§ois Michonneau, & Erin Becker. (2018, May 20). datacarpentry/openrefine-socialsci: OpenRefine Social Sciences Release, May 2018 (v3). Zenodo. https://doi.org/10.5281/zenodo.1250074 -->
<!-- 2. The repository with the data and metadata used in the lesson:  [SAFI_Survey](https://figshare.com/articles/dataset/SAFI_Survey_Results/6262019) -->

2. Data Carpentry: [Data Cleaning with OpenRefine for Ecologists](https://datacarpentry.org/OpenRefine-ecology-lesson/04-scripts/index.html)


# Additional Tools and Resources

*  [Open Refine](https://openrefine.org/) Homepage. Includes the [user's manual](https://docs.openrefine.org/) and links to [more tutorials](https://openrefine.org/documentation.html).

*  [Environmental Data Initiative OpenRefine Tutorial](https://environmentaldatainitiative.org/webinars-events/previous-edi-events/how-to-clean-and-format-data-using-r-packages-datamaid-dplyr-openrefine-excel/)

* Video Tutorials: Cleaning Data with OpenRefine [Video Tutorial No. 1](https://www.youtube.com/watch?v=nORS7STbLyk) and [Video Tutorial No. 2](https://www.youtube.com/watch?v=xZlz4ISgNBc)

*  [JHU Library Cleaning Data with OpenRefine](https://libjohn.github.io/openrefine/index.html)

* The Programming Historian Website: [Cleaning Data with OpenRefine](https://doi.org/10.46430/phen0023) (by Seth van Hooland, Ruben Verborgh, and Max De Wilde).

* Guides for writing OpenRefine commands with General Refine Expression Language
    
    * [OpenRefine GREL](https://docs.openrefine.org/manual/expressions/#grel-general-refine-expression-language)
    * a really good [GREL Guide](https://guides.library.illinois.edu/openrefine/grel) from the Univ Illinois
    * Even better: [OpenRefine cheatsheets](https://code4libtoronto.github.io/2018-10-12-access/GoogleRefineCheatSheets.pdf), including for GREL commands.

*  The [rrefine package](https://cran.r-project.org/web/packages/rrefine/vignettes/rrefine-vignette.html) allows you to do some OpenRefine tasks from within R. 

* The UF Library teaches a number of excellent workshops, including one on using OpenRefine. You can check when the next one will be held (or request one) [here](https://ufl.libcal.com/calendar/workshops/?cid=11693&t=d&d=0000-00-00&cal=11693,5125,8858&inc=0)

